<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="style.css"> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.0/p5.js"></script>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <!-- <script src="script.js"></script> -->

  <style>
    .marker-disabled {
      pointer-events: none;
    }

    .btn {
      width: 45%;
    }

    @font-face {
      font-family: GlassTTY;
      src: url(Glass_TTY_VT220.ttf);
    }

    * {
      font-family: monospace;
      font-size: 14px;

    }

    #progress-text {
      color: #54c36b;
      position: absolute;
      top: 30px;
      left: 10px;
      width: 100%;
    }

    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      overflow-x: hidden;
      /* Prevent horizontal scrolling on smaller screens */
      position: relative;
      width: 100%;
    }

    header {
      background-color: #101319;
      color: #54c36b;
      text-align: center;
      padding: 10px;
      font-size: 16px;
      width: 390px;
    }

    #map-container {
      position: relative;
      width: 390px;
      overflow: hidden;
      height: 824px;
    }

    #campus-map {
      width: 100%;
      height: auto;
      display: block;
    }

    .user-marker {
      position: absolute;
      width: 15px;
      height: 15px;
      border-radius: 50%;
      background-color: red;
      /* User's marker color */
      transform: translate(-50%, -50%);
    }

    .blue-marker {
      position: absolute;
      width: 45px;
      /* Size of the marker image */
      height: 45px;
      /* Size of the marker image */
      background-image: url('marker.png');
      background-size: cover;
      transform: translate(-50%, -50%);
      animation: blink 2s ease-in infinite alternate;
      /* Blinking animation */
    }

    .progress {
      color: #54c36b;
      background-color: #101319;
      border: 3px solid #54c36b;
      border-radius: 0px;
    }

    .progress-bar {
      background-color: #54c36b;
      color: #101319;
      width: 0;
      /* Set initial width to 0 */
    }

    canvas {
      position: absolute;
      top: 0;
      left: 0;
      z-index: 10;
      /* Ensure the canvas is above the map */
      margin-top: 80px;
    }

    /* @keyframes blink {
  from {
    opacity: 1;
  }
  to {
    opacity: 0.1;
  }
} */

    /* Trivia Modal Styling */
    #triviaModal {
      color: #54c36b;

    }

    .modal-content {
      background-color: #101319;
      border: 3px #54c36b solid;
      border-radius: 0px;


    }

    .answer-option {
      margin-top: 10px;
      background-color: #101319;
      border: 3px #54c36b solid;
      font-weight: bold;
    }

    .modal-header {
      border-bottom: #54c36b 2px solid;
      font-weight: bolder;
    }

    .close {
      color: #54c36b;
      font-weight: bolder;
    }
    .img-fluid{
      height: 400px;
      width: auto;
    }
  </style>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // Manually placed marker coordinates
      const markers = [
        { label: 'AW', top: 591.72, left: 192.942 },
        { label: 'Env', top: 503.87, left: 234.986 },
        // { label: 'Makers Space', top: 445.3, left: 232.27 },
        { label: 'Western Gallery', top: 378.91, left: 240.916 },
        // { label: 'Miller Hall', top: 315.42, left: 255.444 },
        { label: 'Wilson Library', top: 222.687, left: 229.025 },
        { label: 'Viking Union', top: 85.101, left: 270.409 }
      ];

      // Display user marker on the map
      const userMarker = document.createElement("div");
      userMarker.className = "user-marker";
      document.getElementById("map-container").appendChild(userMarker);

      // Add manually placed markers with 'marker.png' for specified locations
      markers.forEach(marker => {
        const markerElement = document.createElement("div");
        markerElement.className = "blue-marker";
        markerElement.style.top = marker.top + "px";
        markerElement.style.left = marker.left + "px";
        markerElement.title = marker.label;
        document.getElementById("map-container").appendChild(markerElement);

        markerElement.addEventListener("click", function () {
          showTriviaQuestion(marker.label);
        });
      });
    });

    // Trivia Modal Logic
    function showTriviaQuestion(sectionLabel) {
      var questionAndAnswers = getQuestionAndAnswersBySection(sectionLabel);

      // Display image
      var imageContainer = document.getElementById('imageContainer');
      imageContainer.innerHTML = `<img src="${sectionLabel.toLowerCase()}-q.png" alt="${sectionLabel} Fossil" class="img-fluid">`;

      // Display question
      document.getElementById('questionText').textContent = questionAndAnswers.question;

      // Display answer options
      var answerButtons = document.querySelectorAll('.answer-option');
      var randomizedAnswers = questionAndAnswers.answers.slice().sort(() => Math.random() - 0.5);

      answerButtons.forEach(function (button, i) {
        button.textContent = randomizedAnswers[i];
        button.classList.remove('btn-success', 'btn-danger');
        button.classList.add('btn-secondary');
        if (randomizedAnswers[i] === questionAndAnswers.correctAnswer) {
          button.dataset.correct = true;
          button.dataset.section = sectionLabel; // Store section label in the button dataset
        } else {
          button.dataset.correct = false;
        }
      });

      $('#triviaModal').modal('show');
    }

    function checkAnswer(clickedButton) {
      if (clickedButton.dataset.correct === 'true') {
        clickedButton.classList.remove('btn-secondary');
        clickedButton.classList.add('btn-success');

        var blurredSection = document.querySelector('.blue-marker[title="' + clickedButton.dataset.section + '"]');
        if (blurredSection) {
          blurredSection.style.opacity = '0';
          blurredSection.classList.add('marker-disabled'); // New class to disable click
          updateProgressBar();
        }
      } else {
        clickedButton.classList.remove('btn-secondary');
        clickedButton.classList.add('btn-danger');

        setTimeout(function () {
          clickedButton.classList.remove('btn-danger');
          clickedButton.classList.add('btn-secondary');
        }, 1000);
      }

      setTimeout(function () {
        $('#triviaModal').modal('hide');

        var answerButtons = document.querySelectorAll('.answer-option');
        answerButtons.forEach(function (button) {
          button.classList.remove('btn-success', 'btn-danger');
          button.classList.add('btn-secondary');
          button.dataset.correct = '';
        });
      }, 1000);
    }

    function updateProgressBar() {
      var progressBar = document.getElementById('progress-bar');
      var progressPercent = document.getElementById('progress-percent');
      var markersCompleted = document.getElementById('markers-completed');

      var currentProgress = parseInt(progressBar.style.width) || 0;
      var newProgress = Math.min(currentProgress + (100 / 5), 100); // Increment by 1/7th of total progress

      progressBar.style.width = newProgress + '%';
      progressPercent.textContent = newProgress.toFixed(2) + '%';

      var completedMarkers = document.querySelectorAll('.blue-marker.marker-disabled').length;
      markersCompleted.textContent = completedMarkers + '/5 Points Completed';
    }

    function getQuestionAndAnswersBySection(sectionLabel) {
      switch (sectionLabel) {
        case 'AW':
          return {
            question: 'What does AW stand for?',
            answers: ['Academic West', 'Answer Won', 'Aye, watsup', 'Academic Will'],
            correctAnswer: 'Academic West'
          };
        case 'Env':
          return {
            question: 'These three-toed tracks were collected from 15 million year old lake deposits in Nevada. What creature made them?',
            answers: ['Small Dinosaur', 'Shore Bird', 'Flying Reptile', 'Sloth'],
            correctAnswer: 'Shore Bird'
          };
        case 'Makers Space':
          return {
            question: 'What is Makers Space?',
            answers: ['Answer 1', 'Answer 2', 'Answer 3', 'Answer 4'],
            correctAnswer: 'Answer 2'
          };
        case 'Western Gallery':
          return {
            question: 'Who painted this painting?',
            answers: ['Answer 1', 'Answer 2', 'an artist', 'Answer 4'],
            correctAnswer: 'an artist'
          };
        case 'Miller Hall':
          return {
            question: 'What they sell at cafe',
            answers: ['Answer 1', 'Answer 2', 'coffee', 'Answer 4'],
            correctAnswer: 'coffee'
          };
        case 'Wilson Library':
          return {
            question: 'What food place is located in this building?',
            answers: ['Freshens', 'Underground Coffee House', 'Zoes Bagels', 'Starbucks'],
            correctAnswer: 'Zoes Bagels'
          };
        case 'Viking Union':
          return {
            question: 'What food item is missing from this vending machine?',
            answers: ['Doritos Cool Ranch', 'Ms Vickies Spicy Pickle', 'Tims Jalapeno', 'Sun Chips Salsa'],
            correctAnswer: 'Subway'
          };
        default:
          return {
            question: 'Default Question',
            answers: ['Correct', 'Option 2', 'Option 3', 'Option 4'],
            correctAnswer: 'Correct'
          };
      }
    }
  </script>
</head>

<body>

  <header class="navbar">
    <span class="navbar-brand  h1">// Campus Map Game</span>
    #########################################
  </header>

  <div id="map-container" class="position-relative">
    <div class="progress" style="position: absolute; top: 10px; left: 10px; width: 100px;">
      <div id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%;" aria-valuenow="0"
        aria-valuemin="0" aria-valuemax="100"></div>

    </div>
    <div id="progress-text">
      <p class="m-0">Progress: <span id="progress-percent">0%</span></p>
      <p class="m-0" id="markers-completed">0/5 Points Completed</p>
    </div>

    <img id="campus-map" src="map3.webp" alt="Campus Map" class="img-fluid">
  </div>

  <div class="container mt-3">
    <p id="user-coordinates" class="lead text-center">User Coordinates: Latitude - Longitude</p>
  </div>

  <!-- Trivia Modal -->
  <div class="modal fade" id="triviaModal" tabindex="-1" role="dialog" aria-labelledby="triviaModalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="triviaModalLabel">Trivia Question</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <div id="imageContainer" class="text-center mb-3"></div> <!-- Container for the image -->
          <p id="questionText"></p>
          <button class="btn btn-secondary answer-option" onclick="checkAnswer(this)"></button>
          <button class="btn btn-secondary answer-option" onclick="checkAnswer(this)"></button>
          <button class="btn btn-secondary answer-option" onclick="checkAnswer(this)"></button>
          <button class="btn btn-secondary answer-option" onclick="checkAnswer(this)"></button>
        </div>
      </div>
    </div>
  </div>

</body>

</html>
